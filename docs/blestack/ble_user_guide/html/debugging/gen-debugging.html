

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>External Resources &mdash; BLE-Stack User&#39;s Guide for Bluetooth 4.2 3.01.00.05 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="BLE-Stack User&#39;s Guide for Bluetooth 4.2 3.01.00.05 documentation" href="../index.html"/>
        <link rel="up" title="Debugging" href="ble-index.html"/>
        <link rel="next" title="Debugging a Program Exit" href="ble-debugging.html"/>
        <link rel="prev" title="Debugging" href="ble-index.html"/> 
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug debugging gen-debugging";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script> 

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8">     


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../ble-stack-3.x-guide/index.html" class="icon icon-home"> BLE-Stack User's Guide for Bluetooth 4.2
          

          
          </a>

          
            
            
              <div class="version">
                3.01.00.05
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../cc2640/disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/get-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc2640/platform.html">The CC2640R2F SDK Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x/index.html">Developing a Bluetooth Low Energy Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../u-stack/index.html">Micro BLE Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oad-ble-stack-3.x/oad.html">Over the Air Download (OAD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../voice/voice.html">Creating a Voice Enabled Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../secure-fw-3.x/index.html">Secure Firmware (SFW)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensor-controller/sensor-controller.html">Sensor Controller</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="ble-index.html">Debugging</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">External Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debug-interfaces">Debug Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#connecting-to-the-xds-debugger">Connecting to the XDS Debugger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-debugger-in-ccs">Configuring Debugger in CCS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#find-serial-number">Find Serial Number</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-serial-number">Configure Serial Number</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-debugger-in-iar">Configuring Debugger in IAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#breakpoints">Breakpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#breakpoints-in-ccs">Breakpoints in CCS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#breakpoints-in-iar">Breakpoints in IAR</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#considerations-on-breakpoints">Considerations on Breakpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#breakpoints-and-timing">Breakpoints and Timing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#breakpoints-and-optimization">Breakpoints and Optimization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#watching-variables-and-registers">Watching Variables and Registers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#variables-in-ccs">Variables in CCS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#variables-in-iar">Variables in IAR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#considerations-when-viewing-variables">Considerations When Viewing Variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#memory-watchpoints">Memory Watchpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#watchpoints-in-ccs">Watchpoints in CCS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#watchpoints-in-iar">Watchpoints in IAR</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ti-rtos-object-viewer">TI-RTOS Object Viewer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scanning-the-bios-for-errors">Scanning the BIOS for Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#viewing-the-state-of-each-task">Viewing the State of Each Task</a></li>
<li class="toctree-l3"><a class="reference internal" href="#viewing-the-system-stack">Viewing the System Stack</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-memory-browser">Using the Memory Browser</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging-common-heap-issues">Debugging Common Heap Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#determining-the-auto-heap-size">Determining the Auto Heap Size</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#optimizations">Optimizations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#project-wide-optimizations">Project-Wide Optimizations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#single-file-optimizations">Single-File Optimizations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#single-function-optimizations">Single-Function Optimizations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-ti-rtos-in-rom-symbols">Loading TI-RTOS in ROM Symbols</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deciphering-cpu-exceptions">Deciphering CPU Exceptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exception-cause">Exception Cause</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-ti-rtos-and-rov-to-parse-exceptions">Using TI-RTOS and ROV to Parse Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#debugging-memory-problems">Debugging Memory Problems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#task-and-system-stack-overflow">Task and System Stack Overflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-allocation-errors">Dynamic Allocation Errors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#check-system-flash-and-ram-usage-with-map-file">Check System Flash and RAM Usage With Map File</a></li>
<li class="toctree-l2"><a class="reference internal" href="ble-debugging.html">Debugging a Program Exit</a></li>
<li class="toctree-l2"><a class="reference internal" href="ble-debugging.html#hal-assert-handling">HAL Assert Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/migration.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/api-reference.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/reference.html">Terms and Definitions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../ble-stack-3.x-guide/index.html">BLE-Stack User's Guide for Bluetooth 4.2</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../ble-stack-3.x-guide/index.html">Docs</a> &raquo;</li>
        
          <li><a href="ble-index.html">Debugging</a> &raquo;</li>
        
      <li>External Resources</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="external-resources">
<span id="sec-debugging"></span><h1>External Resources<a class="headerlink" href="#external-resources" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference external" href="https://training.ti.com/debugging-common-application-issues-ti-rtos">Debugging common application problems with TI-RTOS</a> video presentation on training.ti.com.</li>
</ul>
</div>
<div class="section" id="debug-interfaces">
<span id="sec-debug-interface"></span><h1>Debug Interfaces<a class="headerlink" href="#debug-interfaces" title="Permalink to this headline">¶</a></h1>
<p>The CC2640R2F platform supports the cJTAG (2-wire) and JTAG (4-wire)
interfaces. Any debuggers that support cJTAG, like the TI XDS100v3
and XDS200, work natively. Others interfaces, like the IAR I-Jet and
Segger J-Link, can only be used in JTAG mode but their drivers
inject a cJTAG sequence which enables JTAG mode when connecting. The
hardware resources included on the devices for debugging are listed
as follows. Not all debugging functionality is available in all
combinations of debugger and IDE.</p>
<ul class="simple">
<li>Breakpoint unit (FBP) – 6 instruction comparators, 2 literal
comparators</li>
<li>Data watchpoint unit (DWT) – 4 watchpoints on memory access</li>
<li>Instrumentation Trace Module (ITM) – 32 × 32 bit stimulus registers</li>
<li>Trace Port Interface Unit (TPIU) – serialization and time-stamping of
DWT and ITM events</li>
</ul>
<p>The SmartRF06 Board contains a XDS100v3 debug probe, and the CC2650
LaunchPad contains the XDS110 debug probe. These debuggers are used
by default in the respective sample projects.</p>
<div class="section" id="connecting-to-the-xds-debugger">
<h2>Connecting to the XDS Debugger<a class="headerlink" href="#connecting-to-the-xds-debugger" title="Permalink to this headline">¶</a></h2>
<p>If only one debugger is attached, the IDE uses it automatically when you click
the <img alt="img_icon_debug_ccs" src="../_images/icon_debug_ccs.png" /> button in CCS or <img alt="img_icon_debug_iar" src="../_images/icon_debug_iar.png" /> in IAR.</p>
<p>If <strong>multiple debuggers</strong> are connected, you must choose the individual
debugger to use. The following steps detail how to select a debugger in CCS
and IAR.</p>
</div>
</div>
<div class="section" id="configuring-debugger-in-ccs">
<h1>Configuring Debugger in CCS<a class="headerlink" href="#configuring-debugger-in-ccs" title="Permalink to this headline">¶</a></h1>
<p>To select a specific debugger in CCS, do as follows:</p>
<div class="section" id="find-serial-number">
<h2>Find Serial Number<a class="headerlink" href="#find-serial-number" title="Permalink to this headline">¶</a></h2>
<p>To find the serial number for XDS100v3 debuggers, do as follows.</p>
<ol class="arabic simple">
<li>Open a command prompt.</li>
<li>Run <code class="docutils literal"><span class="pre">C:\ti\ccsv6\ccs_base\common\uscif\xds100serial.exe</span></code> to get
a list of serial numbers of the connected debuggers.</li>
</ol>
<p>For XDS110 debuggers (LaunchPads), run the following command: <code class="docutils literal"><span class="pre">c:\ti\ccsv6\ccs_base\common\uscif\xds110\xdsdfu.exe</span> <span class="pre">-e</span></code></p>
</div>
<div class="section" id="configure-serial-number">
<h2>Configure Serial Number<a class="headerlink" href="#configure-serial-number" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="55%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple">
<li>Open the target configuration file.</li>
</ol>
</td>
<td><img alt="../_images/ccs_targetconfig_file.png" class="first last" src="../_images/ccs_targetconfig_file.png" />
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li>Open the Advanced pane.</li>
</ol>
</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="3">
<li>Choose the top-level debugger entry.</li>
</ol>
</td>
<td><img alt="../_images/ccs_targetconfig_probe.png" class="first last" src="../_images/ccs_targetconfig_probe.png" />
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="4">
<li>Enter the serial number.</li>
</ol>
</td>
<td><img alt="../_images/ccs_targetconfig_serial.png" class="first last" src="../_images/ccs_targetconfig_serial.png" />
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="configuring-debugger-in-iar">
<h1>Configuring Debugger in IAR<a class="headerlink" href="#configuring-debugger-in-iar" title="Permalink to this headline">¶</a></h1>
<p>To debug using IAR, do as follows.</p>
<ol class="arabic simple">
<li>Open the project options (Project -&gt; Options)</li>
<li>Go to the Debugger entry.</li>
<li>Go to Extra options.</li>
<li>Add the following command line option:
<code class="docutils literal"><span class="pre">--drv_communication=USB:#select</span></code></li>
</ol>
<p>Adding this command line option makes the IAR prompt which debugger
to use for every connection.</p>
</div>
<div class="section" id="breakpoints">
<h1>Breakpoints<a class="headerlink" href="#breakpoints" title="Permalink to this headline">¶</a></h1>
<p>Both IAR and CCS reserve one of the instruction comparators for stepping etc.
Five hardware breakpoints are available for debugging. This section
describes setting breakpoints in IAR and CCS.</p>
<div class="section" id="breakpoints-in-ccs">
<h2>Breakpoints in CCS<a class="headerlink" href="#breakpoints-in-ccs" title="Permalink to this headline">¶</a></h2>
<p>To toggle a breakpoint, do any of the following.</p>
<ul class="simple">
<li>Double-click the area to the left of the line number.</li>
<li>Press Ctrl+Shift+B.</li>
<li>Right-click on the line.</li>
</ul>
<p>A breakpoint set on line 207 looks like the following.</p>
<div class="figure align-center" id="id2">
<img alt="../_images/ccs_breakpoint_ex.png" src="../_images/ccs_breakpoint_ex.png" />
<p class="caption"><span class="caption-number">Figure 103. </span><span class="caption-text">Breakpoint on line 207. Debugger halted at start of main().</span></p>
</div>
<p>For an overview of the active and inactive breakpoints, click on
View &#8211;&gt; Breakpoints.</p>
<div class="figure align-center" id="id3">
<img alt="../_images/ccs_breakpoint_list.png" src="../_images/ccs_breakpoint_list.png" />
<p class="caption"><span class="caption-number">Figure 104. </span><span class="caption-text">List of breakpoints. Right-click to edit options, or de-select to deactivate.</span></p>
</div>
<p>To set a conditional break, do as follows.</p>
<ol class="arabic simple">
<li>Right-click the breakpoint in the overview.</li>
<li>Choose Properties.</li>
</ol>
<p>When debugging, Skip Count and Condition can help skip a number of
breaks or only break if a variable is a certain value.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Conditional breaks require a debugger response and may
halt the processor long enough to break an active RF connection, or otherwise
disrupt timing on the debug target.</p>
</div>
</div>
<div class="section" id="breakpoints-in-iar">
<h2>Breakpoints in IAR<a class="headerlink" href="#breakpoints-in-iar" title="Permalink to this headline">¶</a></h2>
<p>To toggle a breakpoint, do any of the following.</p>
<ul class="simple">
<li>Single-click the area to the left of the line number.</li>
<li>Go to the line and press F9 to toggle breakpoint</li>
<li>Right-click on the line and select Toggle Breakpoint (Code).</li>
</ul>
<p>A breakpoint looks like this:</p>
<div class="figure align-center" id="id4">
<img alt="../_images/iar_breakpoint_ex.png" src="../_images/iar_breakpoint_ex.png" />
<p class="caption"><span class="caption-number">Figure 105. </span><span class="caption-text">Breakpoint on <code class="docutils literal"><span class="pre">PIN_init()</span></code>. Debugger halted at start of main().</span></p>
</div>
<p>For an overview of the active and inactive breakpoints, click
View &#8211;&gt; Breakpoints.</p>
<div class="figure align-center" id="id5">
<img alt="../_images/iar_breakpoint_list.png" src="../_images/iar_breakpoint_list.png" />
<p class="caption"><span class="caption-number">Figure 106. </span><span class="caption-text">List of breakpoints. Right-click to edit options, or de-select to deactivate.</span></p>
</div>
<p>To set a conditional break, do as follows.</p>
<ol class="arabic simple">
<li>Right-click the breakpoint in the overview.</li>
<li>Choose Edit....</li>
</ol>
<p>When debugging, Skip Count and Condition can help skip a number of
breaks or only break if a variable is a certain value.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Conditional breaks require a debugger response and may
halt the processor long enough to break an active RF connection, or otherwise
disrupt timing on the debug target.</p>
</div>
</div>
</div>
<div class="section" id="considerations-on-breakpoints">
<h1>Considerations on Breakpoints<a class="headerlink" href="#considerations-on-breakpoints" title="Permalink to this headline">¶</a></h1>
<div class="section" id="breakpoints-and-timing">
<h2>Breakpoints and Timing<a class="headerlink" href="#breakpoints-and-timing" title="Permalink to this headline">¶</a></h2>
<p>Synchronous RF protocols like the Bluetooth low energy protocol are timing
sensitive, and breakpoints can easily halt the execution long enough to lose
network timing and break the link.</p>
<p>To still be able to debug, place breakpoints as close as possible
to where the relevant debug information can be read or step through
the relevant code segment to debug.</p>
<p>After you hit a breakpoint and read out the necessary debug information, it is
recommended that you reset the device and re-establish the connection.</p>
</div>
<div class="section" id="breakpoints-and-optimization">
<h2>Breakpoints and Optimization<a class="headerlink" href="#breakpoints-and-optimization" title="Permalink to this headline">¶</a></h2>
<p>When compiler optimizations are enabled, toggling a breakpoint on a
line of C code may not result in the expected behavior. Some
examples include the following.</p>
<dl class="docutils">
<dt>Code is removed or not compiled in</dt>
<dd>Toggling a breakpoint in the IDE results in a breakpoint some other
unintended place and not on the selected line. Some IDEs disable breakpoints
on nonexisting code.</dd>
<dt>Code block is part of a common subexpression</dt>
<dd>For example, a breakpoint might toggle inside a function called from one other
function, but can also break due to a call from another unintended function.</dd>
<dt>An if clause is represented by a conditional branch in assembly</dt>
<dd>A breakpoint inside an if clause always breaks on the conditional
statement, even if not executed.</dd>
</dl>
<p>TI recommends selecting an optimization level as low as possible
when debugging. See <a class="reference internal" href="#sect-debug-optim"><span class="std std-ref">Optimizations</span></a> for information on modifying
optimization levels.</p>
</div>
</div>
<div class="section" id="watching-variables-and-registers">
<h1>Watching Variables and Registers<a class="headerlink" href="#watching-variables-and-registers" title="Permalink to this headline">¶</a></h1>
<p>IAR and CCS provide several ways of viewing the state of a halted
program. Global variables are statically placed during link-time and
can end up anywhere in the RAM available to the project or
potentially in flash if they are declared as a constant value. These
variables can be accessed at any time through the Watch and
Expression windows.</p>
<p>Unless removed due to optimizations, global variables are always
available in these views. Local variables or variables that are only
valid inside a limited scope are placed on the stack of the active
task. Such variables can also be viewed with the Watch or Expression
views, but can also be automatically displayed when breaking or
stepping through code. To view the variables through IAR and CCS, do
as follows.</p>
<div class="section" id="variables-in-ccs">
<h2>Variables in CCS<a class="headerlink" href="#variables-in-ccs" title="Permalink to this headline">¶</a></h2>
<p>You can view Global Variables by doing either of the following.</p>
<ul class="simple">
<li>Select View &#8211;&gt; Expressions</li>
<li>Select a variable name in code.<ul>
<li>Right-click and select Add Watch Expression.</li>
</ul>
</li>
</ul>
<div class="figure align-center" id="id6">
<img alt="../_images/ccs_watch.png" src="../_images/ccs_watch.png" />
<p class="caption"><span class="caption-number">Figure 107. </span><span class="caption-text">Variable watch window. Note that you can cast values, get address and sizeof, etc.</span></p>
</div>
<ul class="simple">
<li>Select View &#8211;&gt; Variables to <code class="docutils literal"><span class="pre">auto-variables</span></code> that are present at the current
location when stepping through code.</li>
</ul>
<div class="figure align-center" id="id7">
<img alt="../_images/ccs_locals.png" src="../_images/ccs_locals.png" />
<p class="caption"><span class="caption-number">Figure 108. </span><span class="caption-text">Local variables. This screenshot is taken during execution of
the Simple Peripheral init function.</span></p>
</div>
</div>
<div class="section" id="variables-in-iar">
<h2>Variables in IAR<a class="headerlink" href="#variables-in-iar" title="Permalink to this headline">¶</a></h2>
<p>To view Global Variables, do either of the following.</p>
<ul class="simple">
<li>Right-click on the variable.<ul>
<li>Select Add to Watch: varName.</li>
</ul>
</li>
<li>Select View &#8211;&gt; Watch n<ul>
<li>Enter the name of the variable.</li>
</ul>
</li>
</ul>
<div class="figure align-center" id="id8">
<img alt="../_images/iar_watch.png" src="../_images/iar_watch.png" />
<p class="caption"><span class="caption-number">Figure 109. </span><span class="caption-text">Variable watch window. Note that you can cast values, get address and sizeof, etc.</span></p>
</div>
<p>View &#8211;&gt; Locals show the local variables in IAR.</p>
<div class="figure align-center" id="id9">
<img alt="../_images/iar_locals.png" src="../_images/iar_locals.png" />
<p class="caption"><span class="caption-number">Figure 110. </span><span class="caption-text">Local variables. This screenshot is taken during execution of
the Simple Peripheral init function.</span></p>
</div>
</div>
<div class="section" id="considerations-when-viewing-variables">
<h2>Considerations When Viewing Variables<a class="headerlink" href="#considerations-when-viewing-variables" title="Permalink to this headline">¶</a></h2>
<p>Local variables are often placed in CPU registers and not on the
stack. These variables also have a limited lifetime even within the
scope in which they are valid, depending on the optimization
performed. Both CCS and IAR may struggle to show a particular
variable due to its limited lifetime. The solution when debugging is
as follows.</p>
<ul class="simple">
<li>Move the variable to global scope, so it remains accessible in RAM.</li>
<li>Make the variable volatile, so the compiler doesn&#8217;t place the value in a
register.</li>
<li>Make a shadow copy of the variable that is global and volatile.</li>
</ul>
<p>IAR may remove the variable during optimization and inline the usage of the
value. If so, add the <code class="docutils literal"><span class="pre">__root</span></code> directive in front.</p>
</div>
</div>
<div class="section" id="memory-watchpoints">
<h1>Memory Watchpoints<a class="headerlink" href="#memory-watchpoints" title="Permalink to this headline">¶</a></h1>
<p>As mentioned in <a class="reference internal" href="#sec-debug-interface"><span class="std std-ref">Debug Interfaces</span></a>, the DWT module contains four memory
watchpoints that allow breakpoints on memory access. The hardware
match functionality looks only at the address. If intended for use
on a variable, the variable must be global. Using watchpoints is
described for IAR and CCS as follows.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a data watchpoint with value match is used, two of the four watchpoints
are used.</p>
</div>
<div class="section" id="watchpoints-in-ccs">
<h2>Watchpoints in CCS<a class="headerlink" href="#watchpoints-in-ccs" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Right-click on a global variable.</li>
<li>Select Breakpoint &#8211;&gt; Hardware Watchpoint</li>
<li>Go to the list of breakpoints (View &#8211;&gt; Breakpoints)</li>
<li>Right-click and edit the Breakpoint Properties to configure the watchpoint.</li>
</ol>
<div class="figure align-center" id="id10">
<img alt="../_images/ccs_watchpoint_add.png" src="../_images/ccs_watchpoint_add.png" />
<p class="caption"><span class="caption-number">Figure 111. </span><span class="caption-text">Adding a watchpoint on a variable.</span></p>
</div>
<p>This example configuration ensures that if 0x42 is written to the
memory location for Characteristic 1 in the Bluetooth low energy
simple_peripheral example project the device halts execution.</p>
<div class="figure align-center" id="id11">
<img alt="../_images/ccs_watchpoint_configure.png" src="../_images/ccs_watchpoint_configure.png" />
<p class="caption"><span class="caption-number">Figure 112. </span><span class="caption-text">Configuring a hardware watchpoint to break on 8-bit write with value 0x42.</span></p>
</div>
</div>
<div class="section" id="watchpoints-in-iar">
<h2>Watchpoints in IAR<a class="headerlink" href="#watchpoints-in-iar" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Right-click a variable (global).</li>
<li>Select <code class="docutils literal"><span class="pre">Set</span> <span class="pre">Data</span> <span class="pre">Breakpoint</span> <span class="pre">for</span> <span class="pre">'myVar'</span></code> to add it to the active breakpoints.</li>
<li>Go to the list of breakpoints (View &#8211;&gt; Breakpoints)</li>
<li>Choose Edit... to set up whether the watchpoint should match on read,
write, or any access.</li>
</ol>
<div class="figure align-center" id="id12">
<img alt="../_images/iar_watchpoint_configure.png" src="../_images/iar_watchpoint_configure.png" />
<p class="caption"><span class="caption-number">Figure 113. </span><span class="caption-text">Configuring a hardware watchpoint to break on 8-bit write with value 0x42.</span></p>
</div>
</div>
</div>
<div class="section" id="ti-rtos-object-viewer">
<h1>TI-RTOS Object Viewer<a class="headerlink" href="#ti-rtos-object-viewer" title="Permalink to this headline">¶</a></h1>
<p>Both IAR and CCS include the RTOS Object Viewer (ROV) plug-in that
provides insight into the current state of TI-RTOS, including task
states, stacks, and so forth. Because both CCS and IAR have a
similar interface, these examples discuss only CCS.</p>
<p>To access the ROV in IAR:</p>
<ul class="simple">
<li>Use the TI-RTOS menu on the menu bar.</li>
<li>Select a subview.</li>
</ul>
<p>To access the ROV in CCS:</p>
<ul class="simple">
<li>Click the Tools menu.</li>
<li>Click RTOS Object View (ROV).</li>
</ul>
<p>This section discusses some ROV views useful for debugging and
profiling. More details can be found in the TI-RTOS User&#8217;s Guide,
including documentation on how to add log events to application code.</p>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When using autosized heap, the ROV may display errors when accesing modules
such as Task and Heap for ROV Classic. In order to use ROV with an autosized
heap, the following steps may be taken:</p>
<dl class="last docutils">
<dt>&#8211; CCS:</dt>
<dd><ul class="first last simple">
<li>Use ROV2</li>
</ul>
</dd>
<dt>&#8211; IAR:</dt>
<dd><ul class="first last simple">
<li>See the BLE-Stack wiki page for a workaround using ROV Classic with
autosized heap.</li>
</ul>
</dd>
</dl>
</div>
</div></blockquote>
<div class="section" id="scanning-the-bios-for-errors">
<h2>Scanning the BIOS for Errors<a class="headerlink" href="#scanning-the-bios-for-errors" title="Permalink to this headline">¶</a></h2>
<p>The BIOS <code class="docutils literal"><span class="pre">Scan</span> <span class="pre">for</span> <span class="pre">errors</span></code> view goes through the
available ROV modules and reports on errors. This functionality can
be a good point to start if anything has gone wrong. This
scan only shows errors related to TI-RTOS modules and only the
errors it can catch.</p>
<div class="figure align-center" id="id13">
<img alt="../_images/rov_bios_scan.png" src="../_images/rov_bios_scan.png" />
<p class="caption"><span class="caption-number">Figure 114. </span><span class="caption-text">Scan for errors. Here a Task Stack has been overrun.</span></p>
</div>
</div>
<div class="section" id="viewing-the-state-of-each-task">
<h2>Viewing the State of Each Task<a class="headerlink" href="#viewing-the-state-of-each-task" title="Permalink to this headline">¶</a></h2>
<p>The Task <code class="docutils literal"><span class="pre">Detailed</span></code> view is useful for seeing the state of
each task and its related runtime stack usage. This example shows
the state the first time the user-thread is called. <a class="reference internal" href="#fig-rov-task-detailed"><span class="std std-numref">Figure 115.</span></a>
shows the Bluetooth low energy stack task, represented by its ICall proxy,
the Idle task, the simple_peripheral task and the GAPRole task.</p>
<div class="figure align-center" id="id14">
<span id="fig-rov-task-detailed"></span><img alt="../_images/rov_task_detailed.png" src="../_images/rov_task_detailed.png" />
<p class="caption"><span class="caption-number">Figure 115. </span><span class="caption-text">Detailed view of the Tasks. Notice the address of the overrun task
matches the instance id from Scan for errors.</span></p>
</div>
<p>The following list explains the column in <a class="reference internal" href="#fig-rov-task-detailed"><span class="std std-numref">Figure 115.</span></a></p>
<dl class="docutils">
<dt>address</dt>
<dd>This column shows the memory location of the Task_Struct
instance for each task.</dd>
<dt>priority</dt>
<dd>This column shows the TI-RTOS priority for the task.</dd>
<dt>mode</dt>
<dd>This column shows the current state of the task.</dd>
<dt>fxn</dt>
<dd>This column shows the name of the entry function of the task.</dd>
<dt>arg0, arg1</dt>
<dd>These columns show abitrary values that can be given to
entry function of the task. In the image, the ICall_taskEntry is
given 0xb001, which is the flash location of the entry function
of the RF stack image and 0x20003a30 (the location of
bleUserCfg_t user0Cfg, defined in main()).</dd>
<dt>stackPeak</dt>
<dd>This column shows the maximum run-time stack memory used
based on watermark in RAM, where the stacks are prefilled with
0xBE and there is a sentinel word at the end of the run-time
stack.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Function calls may push the stack pointer out of the
run-time stack, but not actually write to the entire area. A stack
peak near stackSize but not exceeding it may indicate stack
overflow.</p>
</div>
<dl class="docutils">
<dt>stackSize</dt>
<dd>This column shows the size of the runtime stack,
configured when instantiating a task.</dd>
<dt>stackBase</dt>
<dd>This column shows the logical top of the runtime stack of
the task (usage starts at stackBase + stackSize and grows down to
this address).</dd>
</dl>
</div>
<div class="section" id="viewing-the-system-stack">
<h2>Viewing the System Stack<a class="headerlink" href="#viewing-the-system-stack" title="Permalink to this headline">¶</a></h2>
<p>The Hwi <code class="docutils literal"><span class="pre">Module</span></code> view allows profiling of the system stack
used during boot or for main(), Hwi execution, and Swi execution.
See <a class="reference internal" href="../cc2640/memory_management.html#sec-memory-management-system-stack"><span class="std std-ref">System Stack</span></a> for more information on the system
stack.</p>
<div class="figure align-center" id="id15">
<img alt="../_images/rov_hwi_module.png" src="../_images/rov_hwi_module.png" />
<p class="caption"><span class="caption-number">Figure 116. </span><span class="caption-text">Viewing the System Stack in Hwi</span></p>
</div>
<p>The hwiStackPeak, hwiStackSize, and hwiStackBase can be used to check
for system stack overflow.</p>
</div>
</div>
<div class="section" id="using-the-memory-browser">
<h1>Using the Memory Browser<a class="headerlink" href="#using-the-memory-browser" title="Permalink to this headline">¶</a></h1>
<p>Both IAR and CCS are able to show a representation of the memory on the device.
In CCS, you can index by address or by symbol name. As an example, consider the
stack that was overrun in <a class="reference internal" href="#fig-rov-task-detailed"><span class="std std-numref">Figure 115.</span></a>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Simple Peripheral Task&#8217;s stack. Note <code class="docutils literal"><span class="pre">BE</span></code> watermark</td>
<td>GAPRole Task&#8217;s stack. Note it&#8217;s completely filled.</td>
</tr>
<tr class="row-even"><td><div class="first last figure">
<img alt="../_images/mem_browser_sbp_stack.png" src="../_images/mem_browser_sbp_stack.png" />
</div>
</td>
<td><div class="first last figure">
<img alt="../_images/mem_browser_gaprole_stack.png" src="../_images/mem_browser_gaprole_stack.png" />
</div>
</td>
</tr>
</tbody>
</table>
<p>The solution in this case would be to increase the stack size for the failing task
and see what the stack peak really is. The <code class="docutils literal"><span class="pre">stackPeak</span></code> reported is relying on
how many watermark bytes are overwritten, so it can&#8217;t know how much the overrun
amounts to.</p>
<p>Because stacks are utilized from higher addresses towards lower addressed
(upwards in the picture), stacks that overrun will tend to overwrite data
at locations immediately before the stack.</p>
</div>
<div class="section" id="debugging-common-heap-issues">
<span id="sec-heap-debugging"></span><span id="sect-icall-profiling"></span><h1>Debugging Common Heap Issues<a class="headerlink" href="#debugging-common-heap-issues" title="Permalink to this headline">¶</a></h1>
<p>As described in <a class="reference internal" href="../cc2640/memory_management.html#dynamic-memory-allocation"><span class="std std-ref">Dynamic Memory Allocation</span></a>, the Heap Manager and its
heap are used to allocate messages between the Bluetooth low energy stack
task and the application task and as dynamic memory allocations in
the tasks, as well as in TI-RTOS.</p>
<p>Profiling functionality is provided for the heap but is not
enabled by default. Therefore, it must be compiled in by adding
<code class="docutils literal"><span class="pre">HEAPMGR_METRICS</span></code> to the defined preprocessor symbols. This
functionality is useful for finding potential sources for
unexplained behavior and to optimize the size of the heap. When
<code class="docutils literal"><span class="pre">HEAPMGR_METRICS</span></code> is defined, the variables and functions listed as
follows become available. Global variables:</p>
<dl class="docutils">
<dt>heapmgrBlkMax</dt>
<dd>The maximum amount of simultaneous allocated blocks</dd>
<dt>heapmgrBlkCnt</dt>
<dd>The current amount of allocated blocks</dd>
<dt>heapmgrBlkFree</dt>
<dd>The current amount of free blocks</dd>
<dt>heapmgrMemAlo</dt>
<dd>The current total memory allocated in bytes</dd>
<dt>heapmgrMemMax</dt>
<dd>The maximum amount of simultaneous allocated memory in
blocks (this value must not exceed the size of the heap)</dd>
<dt>heapmgrMemUb</dt>
<dd>The furthest memory location of an allocated block,
measured as an offset from the start of the heap</dd>
<dt>heapmgrMemFail</dt>
<dd>The amount of memory allocation failure (instances
where <code class="docutils literal"><span class="pre">ICall_malloc()</span></code> has returned NULL)</dd>
</dl>
<p>Furthermore when using a TI-RTOS based heap such as HeapMem or HeapTrack, there
is additional debugging capability that can be used.</p>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>Note the below functions are enabled only for the legacy OSAL heap, TI-RTOS
based heap implementations offer native support for their functionality.</p>
<dl class="docutils">
<dt><code class="samp docutils literal"><span class="pre">void</span> <em><span class="pre">ICall_heapGetMetrics</span></em><span class="pre">(u16</span> <span class="pre">*pBlkMax,</span> <span class="pre">u16</span> <span class="pre">*pBlkCnt,</span> <span class="pre">u16</span> <span class="pre">*pBlkFree,</span> <span class="pre">u16</span> <span class="pre">*pMemAlo,</span> <span class="pre">u16</span> <span class="pre">*pMemMax,</span> <span class="pre">u16</span> <span class="pre">*pMemUb)</span></code></dt>
<dd>Returns the previously described variables in the pointers passed in as parameters</dd>
<dt><code class="samp docutils literal"><span class="pre">int</span> <span class="pre">heapmgrSanityCheck(void)</span></code></dt>
<dd>Returns 0 if the heap is ok; otherwise, returns a nonzero (that is, an array access has overwritten a header in the heap)</dd>
</dl>
<p>However, the get stats function is available to all three supported heap
configurations.</p>
<dl class="docutils">
<dt><code class="samp docutils literal"><span class="pre">ICall_getHeapStats(ICall_heapStats_t)</span></code></dt>
<dd>Returns a pointer to the Heap statics structure.</dd>
</dl>
<p>The heap stats stucture, is defined as below:</p>
<blockquote>
<div><div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <span class="kt">uint32_t</span> <span class="n">totalSize</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">totalFreeSize</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">largestFreeSize</span><span class="p">;</span>
<span class="p">}</span><span class="n">ICall_heapStats_t</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="determining-the-auto-heap-size">
<h2>Determining the Auto Heap Size<a class="headerlink" href="#determining-the-auto-heap-size" title="Permalink to this headline">¶</a></h2>
<p>The following procedure can be used to view the size of the ICall
heap when the auto heap size feature is enabled (<code class="docutils literal"><span class="pre">HEAPMGR_SIZE=0</span></code>).</p>
<p>At runtime, view the value of the global memory symbol <code class="docutils literal"><span class="pre">HEAPMGR_SIZE</span></code>
after <code class="docutils literal"><span class="pre">ICall_init()</span></code> has been executed in main(). The value of
<code class="docutils literal"><span class="pre">HEAPMGR_SIZE</span></code> is the total size of the ICall heap. See
<code class="docutils literal"><span class="pre">HEAPMGR_INIT()</span></code> in heapmgr.h for the source code implementation.</p>
<ul class="simple">
<li>In IAR: View -&gt; Watch -&gt; Watch 1, add <code class="docutils literal"><span class="pre">HEAPMGR_SIZE</span></code></li>
<li>In CCS Debug Session: View -&gt; Expressions, add <code class="docutils literal"><span class="pre">HEAPMGR_SIZE</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The auto heap size feature does not determine the amount
of heap needed for the application. The system designer must ensure
that the heap has the required space to meet the application’s
runtime memory requirements.</p>
<p class="last">Due to memory placement, the actual heap size may be up to 4 bytes less.</p>
</div>
<p>To calculate the size of the heap by inspecting the map file:</p>
<p>The size of the heap is the difference between the address of
the last item in the .bss section and the start address of the
system stack (CSTACK). For example, the</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-number">Listing 92. </span><span class="caption-text">The gap between heapStart end and heapEnd start.</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-text"><div class="highlight"><pre><span></span>20003f48  heapEnd
20001cc1  heapStart
</pre></div>
</div>
</div>
<p>The size of the ICall heap in this example is defined as:
<code class="docutils literal"><span class="pre">0x20003f48</span> <span class="pre">-</span> <span class="pre">0x20001cc1</span> <span class="pre">=</span> <span class="pre">0x2287</span></code> or <code class="docutils literal"><span class="pre">8839</span> <span class="pre">bytes</span></code> for the heap.</p>
</div>
</div>
<div class="section" id="optimizations">
<span id="sect-debug-optim"></span><h1>Optimizations<a class="headerlink" href="#optimizations" title="Permalink to this headline">¶</a></h1>
<p>While debugging, turn off or lower optimizations to ease
single-stepping through code. Optimization level can be configured at the
<em>project</em>, <em>file</em> and <em>function</em> levels.</p>
<div class="section" id="project-wide-optimizations">
<h2>Project-Wide Optimizations<a class="headerlink" href="#project-wide-optimizations" title="Permalink to this headline">¶</a></h2>
<p>For debugging, ideally, the project-wide settings for optimization should be as
low as possible. There may not be enough available space on the target to do this,
but lowering just a couple of levels can be helpful.</p>
<p><strong>In IAR</strong></p>
<p>Project Options &#8211;&gt; C/C++ Compiler &#8211;&gt; Optimizations</p>
<div class="figure align-center" id="id17">
<img alt="../_images/iar_optim_level_project.png" src="../_images/iar_optim_level_project.png" />
<p class="caption"><span class="caption-number">Figure 117. </span><span class="caption-text">Project-level optimization setting in IAR</span></p>
</div>
<p><strong>In CCS</strong></p>
<p>Project Properties &#8211;&gt; CCS Build &#8211;&gt; ARM Compiler &#8211;&gt; Optimization</p>
<div class="figure align-center" id="id18">
<img alt="../_images/ccs_optim_level_project.png" src="../_images/ccs_optim_level_project.png" />
<p class="caption"><span class="caption-number">Figure 118. </span><span class="caption-text">Project-level optimization setting in CCS</span></p>
</div>
</div>
<div class="section" id="single-file-optimizations">
<h2>Single-File Optimizations<a class="headerlink" href="#single-file-optimizations" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Do single-file optimizations with care because this also
overrides the project-wide preprocessor symbols.</p>
</div>
<p><strong>In IAR</strong></p>
<ol class="arabic simple">
<li>Right-click on the file in the Workspace pane.</li>
<li>Choose Options.</li>
<li>Check Override inherited Settings.</li>
<li>Choose the optimization level.</li>
</ol>
<p><strong>In CCS</strong></p>
<ol class="arabic simple">
<li>Right-click on the file in the Workspace pane.</li>
<li>Choose Properties.</li>
<li>Change the optimization level of the file using the same menu in the
CCS project-wide optimization menu.</li>
</ol>
</div>
<div class="section" id="single-function-optimizations">
<h2>Single-Function Optimizations<a class="headerlink" href="#single-function-optimizations" title="Permalink to this headline">¶</a></h2>
<p>Using compiler directives, you can control the optimization level of
a single function.</p>
<p><strong>In IAR</strong></p>
<p>Use #pragma optimize=none before the function definition to
deoptimize the entire function, that is, as follows.</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-number">Listing 93. </span><span class="caption-text">Function-level optimization setting in IAR</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="hll"><span class="cp">#pragma optimize=none</span>
</span><span class="k">static</span> <span class="kt">void</span> <span class="nf">myFunction</span><span class="p">(</span><span class="kt">int</span> <span class="n">number</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="n">yourFunction</span><span class="p">(</span><span class="n">other_number</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p><strong>In CCS</strong></p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-number">Listing 94. </span><span class="caption-text">Function-level optimization setting in CCS</span><a class="headerlink" href="#id20" title="Permalink to this code">¶</a></div>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="hll"><span class="cp">#pragma FUNCTION_OPTIONS(myFunction, &quot;--opt_level=0&quot;)</span>
</span><span class="k">static</span> <span class="kt">void</span> <span class="nf">myFunction</span><span class="p">(</span><span class="kt">int</span> <span class="n">number</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="n">yourFunction</span><span class="p">(</span><span class="n">other_number</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="loading-ti-rtos-in-rom-symbols">
<h2>Loading TI-RTOS in ROM Symbols<a class="headerlink" href="#loading-ti-rtos-in-rom-symbols" title="Permalink to this headline">¶</a></h2>
<p>Some of the TI-RTOS kernel modules are included in ROM, and executed from ROM
in order to save Flash space for the application. This can lead to some
confusion, when only addresses are shown in the disassembly view and the
call-stack view.</p>
<p>All TI-RTOS kernel code in ROM starts with address <code class="docutils literal"><span class="pre">0x1001xxxx</span></code>. In order to
make sense of the ROM&#8217;ed code, you need to include the symbol files in your
debug session.</p>
<p><strong>In IAR</strong></p>
<div class="figure align-center" id="id21">
<img alt="../_images/rtos_symbols_add_iar.png" src="../_images/rtos_symbols_add_iar.png" />
<p class="caption"><span class="caption-number">Figure 119. </span><span class="caption-text">Adding symbol information for the BIOS kernel in ROM</span></p>
</div>
<ul class="simple">
<li>In the project options, go to <code class="docutils literal"><span class="pre">Debugger</span></code> and <code class="docutils literal"><span class="pre">Images</span></code>, then add the image</li>
<li><code class="docutils literal"><span class="pre">&lt;SDK_INSTALL_DIR&gt;\kernel\tirtos\packages\ti\sysbios\rom\cortexm\cc26xx\r2\golden\CC26xx\rtos_rom.xem3</span></code></li>
<li>Check the box for &#8216;Debug info only&#8217;, and use Offset = 0.</li>
</ul>
<p><strong>In CCS</strong></p>
<div class="figure align-center" id="id22">
<img alt="../_images/rtos_symbols_add_ccs.png" src="../_images/rtos_symbols_add_ccs.png" />
<p class="caption"><span class="caption-number">Figure 120. </span><span class="caption-text">Adding symbol information for the BIOS kernel in ROM, via Add Symbols.</span></p>
</div>
<ul class="simple">
<li>While in debug mode, click the drop-down button next to the Load Program icon</li>
<li>Select Add Symbols..</li>
<li>Select Browse.. and find</li>
<li><code class="docutils literal"><span class="pre">&lt;SDK_INSTALL_DIR&gt;\kernel\tirtos\packages\ti\sysbios\rom\cortexm\cc26xx\r2\golden\CC26xx\rtos_rom.xem3</span></code></li>
</ul>
</div>
</div>
<div class="section" id="deciphering-cpu-exceptions">
<h1>Deciphering CPU Exceptions<a class="headerlink" href="#deciphering-cpu-exceptions" title="Permalink to this headline">¶</a></h1>
<p>Several possible exception causes exist. If an exception is caught,
an exception handler function can be called. Depending on the
project settings, this handler may be a default handler in ROM,
which is just an infinite loop or a custom function called from this
default handler instead of a loop.</p>
<p>When an exception occurs, the exception may be caught and halted in
debug mode immediately, depending on the debugger. If the execution
halted manually later through the Break debugger, it is then stopped
within the exception handler loop.</p>
<div class="section" id="exception-cause">
<h2>Exception Cause<a class="headerlink" href="#exception-cause" title="Permalink to this headline">¶</a></h2>
<p>With the default setup using TI-RTOS, the exception cause can be
found in the System Control Space register group (CPU_SCS) in the
register CFSR (Configurable Fault Status Register). The ARM
Cortex-M3 User Guide describes this register. Most exception causes
fall into the following three categories.</p>
<ul class="simple">
<li>Stack overflow or corruption leads to arbitrary code execution.<ul>
<li>Almost any exception is possible.</li>
</ul>
</li>
<li>A NULL pointer has been dereferenced and written to.<ul>
<li>Typically (IM)PRECISERR exceptions</li>
</ul>
</li>
<li>A peripheral module (like UART, Timer, and so forth) is accessed
without being powered.<ul>
<li>Typically (IM)PRECISERR exceptions</li>
</ul>
</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">CFSR</span></code> register is available in View &#8211;&gt; Registers in IAR and CCS.</p>
<p>When an access violation occurs, the exception type is IMPRECISERR
because writes to flash and peripheral memory regions are mostly
buffered writes.</p>
<p>If the CFSR:BFARVALID flag is set when the exception occurs (typical
for PRECISERR), the BFAR register in CPU_SCS can be read out to
find which memory address caused the exception.</p>
<p>If the exception is IMPRECISERR, PRECISERR can be forced by manually
disabling buffered writes. Set [CPU_SCS:ACTRL:DISDEFWBUF] to 1, by
either manually setting the bit in the register view in IAR/CCS or
by including &lt;hw_cpu_scs.h&gt; from Driverlib and calling the
following.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/devices/cc26x0r2/inc/hw_cpu_scs.h&gt;</span><span class="cp"></span>
<span class="c1">//..</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Disable write-buffering. Note that this negatively affect performance.</span>
  <span class="n">HWREG</span><span class="p">(</span><span class="n">CPU_SCS_BASE</span> <span class="o">+</span> <span class="n">CPU_SCS_O_ACTLR</span><span class="p">)</span> <span class="o">=</span> <span class="n">CPU_SCS_ACTLR_DISDEFWBUF</span><span class="p">;</span>

  <span class="c1">// ..</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="using-ti-rtos-and-rov-to-parse-exceptions">
<h2>Using TI-RTOS and ROV to Parse Exceptions<a class="headerlink" href="#using-ti-rtos-and-rov-to-parse-exceptions" title="Permalink to this headline">¶</a></h2>
<p>To enable exception decoding in the RTOS Object View (ROV) without using
too much memory, use the Minimal exception handler in TI-RTOS. The
default choice in the BLE-Stack projects is to use no exception
handler.</p>
<p>To set this up, change the section of the TI-RTOS configuration file
that relates to M3Hwi so that it looks like the code below:</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="c1">//m3Hwi.enableException = true;</span>
<span class="nx">m3Hwi</span><span class="p">.</span><span class="nx">enableException</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="c1">//m3Hwi.excHandlerFunc = null;</span>
<span class="nx">m3Hwi</span><span class="p">.</span><span class="nx">excHookFunc</span> <span class="o">=</span> <span class="s2">&quot;&amp;execHandlerHook&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Then, make a function somewhere with the signature
<code class="docutils literal"><span class="pre">void</span> <span class="pre">(*Hwi_ExceptionHookFuncPtr)(Hwi_ExcContext*);</span></code> such as the one below:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ti/sysbios/family/arm/m3/Hwi.h&gt;</span><span class="cp"></span>
<span class="c1">// ...</span>
<span class="k">volatile</span> <span class="kt">uintptr_t</span> <span class="o">*</span><span class="n">excPC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">volatile</span> <span class="kt">uintptr_t</span> <span class="o">*</span><span class="n">excCaller</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// ...</span>
<span class="kt">void</span> <span class="nf">execHandlerHook</span><span class="p">(</span><span class="n">Hwi_ExcContext</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">excPC</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">pc</span><span class="p">;</span>     <span class="c1">// Program counter where exception occurred</span>
    <span class="n">excCaller</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">lr</span><span class="p">;</span> <span class="c1">// Link Register when exception occurred</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Setting <code class="docutils literal"><span class="pre">m3Hwi.enableException</span></code> to false enables the minimal handler,
which fills out the global Hwi_ExcContext structure that the ROV
looks at to show the decoded exception. By setting up an
excHookFunc, the minimal exception handler will call this function
and pass along a pointer to the exception context for the user to
work with. This structure is defined in
<code class="docutils literal"><span class="pre">&lt;ti/sysbios/family/arm/m3/Hwi.h&gt;</span></code>.</p>
<p>When an exception occurs, the device should end up in that infinite
loop. Inspect the ROV -&gt; Hwi -&gt; Exception information.</p>
<div class="figure align-center" id="id23">
<img alt="../_images/rov_hwi_exception.png" src="../_images/rov_hwi_exception.png" />
<p class="caption"><span class="caption-number">Figure 121. </span><span class="caption-text">Decoded exception, intentional write to address 0x0013 which is illegal. Note
that writebuffering has been disabled to get a precise error location, and that
m3Hwi.enableException has been set to false to get the decoding.</span></p>
</div>
<p>In this case, a bus fault was forced in the function writeToAddress by
dereferencing address 0x0013 and trying to write to it:</p>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-number">Listing 95. </span><span class="caption-text">Write to an address in the FLASH memory region.</span><a class="headerlink" href="#id24" title="Permalink to this code">¶</a></div>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">writeToAddress</span><span class="p">(</span><span class="kt">uintptr_t</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
   <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">addr</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ..</span>

<span class="kt">void</span> <span class="nf">taskFxn</span><span class="p">(...)</span>
<span class="p">{</span>
   <span class="c1">// ..</span>
   <span class="n">writeToAddress</span><span class="p">(</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">19</span><span class="p">,</span> <span class="mi">4</span> <span class="p">);</span> <span class="c1">// Randomly chosen values</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The write instruction was placed on line 79 of application.c, as indicated.
To get a precise location, the write buffer was disabled as described earlier.</p>
<p>It can be instructive to look at the disassembly view for the locations
specified by PC (program counter) and LR (link register). PC is the
presumed exception location, and LR is normally the location the failing
function should have returned to. As an example, the PC at this
exception:</p>
<div class="figure align-center" id="id25">
<img alt="../_images/exception_pc_of_write.png" src="../_images/exception_pc_of_write.png" />
<p class="caption"><span class="caption-number">Figure 122. </span><span class="caption-text">Here the <code class="docutils literal"><span class="pre">pc</span></code> from the decoded exception was looked up in the disassembly
view.</span></p>
</div>
<p>Some forensics is required here. We have from the Hwi decoding in ROV (and from
the exception context in the exception hook) that the program counter was
<code class="docutils literal"><span class="pre">0x708e</span></code> when the exception occurred.</p>
<p>At that location there is a store instruction <code class="docutils literal"><span class="pre">str</span> <span class="pre">r0,</span> <span class="pre">[r1]</span></code> meaning, store
the value in R0 to the memory address in R1. The business with <code class="docutils literal"><span class="pre">SP</span></code> in the
figure above is related to optimization being turned off, so all local variables
are stored on the stack, even though in this case R0 and R1 could have been used
directly from the caller.</p>
<p>Now we know that the exception occured because soneone called <cite>writeToAddress</cite>
with an invalid address.</p>
<p>Thanks to the exception decoder we can easily find the call site by
looking at the call stack, but if the call stack isn&#8217;t helpful, we can look
at <code class="docutils literal"><span class="pre">lr</span></code>, which is seen in the exception decoder to be <code class="docutils literal"><span class="pre">0x198f</span></code></p>
<div class="figure align-center" id="id26">
<img alt="../_images/exception_lr_of_write.png" src="../_images/exception_lr_of_write.png" />
<p class="caption"><span class="caption-number">Figure 123. </span><span class="caption-text">Call site as specified in <code class="docutils literal"><span class="pre">lr</span></code>. Note that lr is the instruction after the
call to <code class="docutils literal"><span class="pre">writeToAddress</span></code> because execution would have resumed here.</span></p>
</div>
<p>We can see here that R0 and R1 are initialized with constants. This means that some
programmer has intentionally called the write function with an address that
causes a busfault.</p>
<p>Most often the reason for a bus-fault is that a pointer is not initialized
and a function like <code class="docutils literal"><span class="pre">writeToAddress</span></code> gets the pointer, assumes it&#8217;s valid and
dereferences the pointer and writes to the invalid address.</p>
</div>
</div>
<div class="section" id="debugging-memory-problems">
<span id="development-and-debugging-debugging-memory-problems"></span><h1>Debugging Memory Problems<a class="headerlink" href="#debugging-memory-problems" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to debug a situation where the program
runs out of memory, either on the heap or on the runtime stack for
the individual thread contexts. Exceeding array bounds or
dynamically allocating too little memory for a structure corrupts
the memory and can cause an exception like INVPC, INVSTATE, IBUSERR
to appear in the CFSR register.</p>
<div class="section" id="task-and-system-stack-overflow">
<h2>Task and System Stack Overflow<a class="headerlink" href="#task-and-system-stack-overflow" title="Permalink to this headline">¶</a></h2>
<p>If an overflow on the runtime stack of the task or the system stack
occurs (as found using the ROV plug-in), perform the following steps.</p>
<ol class="arabic simple">
<li>Note the current size of the runtime stack of each task.</li>
<li>Increase by a few 100 bytes as described in
<a class="reference internal" href="../cc2640/rtos-overview.html#sec-rtos-overview-initializing-a-task"><span class="std std-ref">Initializing a Task</span></a> and
<a class="reference internal" href="../cc2640/memory_management.html#sec-memory-management-system-stack"><span class="std std-ref">System Stack</span></a></li>
<li>Reduce the runtime stack sizes so that they are larger than their
respective stackPeaks to save some memory.</li>
</ol>
</div>
<div class="section" id="dynamic-allocation-errors">
<span id="development-and-debugging-dynamic-allocation-errors"></span><h2>Dynamic Allocation Errors<a class="headerlink" href="#dynamic-allocation-errors" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#sect-icall-profiling"><span class="std std-ref">Debugging Common Heap Issues</span></a> describes how to use the ICall Heap profiling
functionality. To check if dynamic allocation errors occurred, do as
follows:</p>
<ol class="arabic simple">
<li>Check whether <code class="docutils literal"><span class="pre">heapmgrMemAlo</span></code> or <code class="docutils literal"><span class="pre">heapmgrMemAlo</span></code> are close to
<code class="docutils literal"><span class="pre">HEAPMGR_SIZE</span></code></li>
<li>Check memFail to see if allocation failures have occurred.</li>
<li>Call the sanity check function.</li>
</ol>
<p>If the heap is sane but there are allocation errors, increase
<code class="docutils literal"><span class="pre">HEAPMGR_SIZE</span></code> and see if the problem persists.</p>
<p>You can set a breakpoint in heapmgr.h in <code class="docutils literal"><span class="pre">HEAPMGR_MALLOC()</span></code> on the
line <code class="docutils literal"><span class="pre">hdr</span> <span class="pre">=</span> <span class="pre">NULL;</span></code> to find an allocation that is failing.</p>
</div>
</div>
<div class="section" id="check-system-flash-and-ram-usage-with-map-file">
<span id="development-and-debugging-check-system-flash-and-ram-usage-with-map-file"></span><h1>Check System Flash and RAM Usage With Map File<a class="headerlink" href="#check-system-flash-and-ram-usage-with-map-file" title="Permalink to this headline">¶</a></h1>
<p>Both application and stack projects produce a map file which can be
used to compute the combined flash and RAM system memory usage. Both
projects have their own memory space and both map files must be
analyzed to determine the total system memory usage. The map file is
in the output folder of the respective project in IAR. To compute
the total memory usage, do as follows.</p>
<ol class="arabic simple">
<li>Open the application map file (that is,
simple_peripheral_cc2650r2lp_app.map).</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At the end of the file, three lines contain a breakdown of
memory usage for read-only code, read-only data, and read/write
data.</p>
</div>
<ol class="arabic simple" start="2">
<li>Add the two values for read-only code and read-only data memory.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This sum is the total flash memory usage for the
application project. The read/write data memory is the total RAM
usage by the application project.</p>
</div>
<ol class="arabic simple" start="3">
<li>Note these values.</li>
<li>Open the stack map file.</li>
<li>Compute the same flash and RAM values for the stack project.</li>
<li>Add the total flash memory value from the application with the total
flash usage of the stack to determine the total system flash
usage.</li>
<li>Add the total RAM usage from the application with the stack to get
the total system RAM usage.</li>
</ol>
<p>For CCS, the map file of the respective project gives a summary of
flash and RAM usage. To determine the remaining available memory for
each project, see <a class="reference internal" href="../cc2640/memory_management.html#flash"><span class="std std-ref">Flash</span></a> and <a class="reference internal" href="../cc2640/memory_management.html#ram"><span class="std std-ref">RAM</span></a>. Due to section placement and
alignment requirements, some remaining memory may be unavailable. The map file
memory usage is valid only if the project builds and links successfully.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ble-debugging.html" class="btn btn-neutral float-right" title="Debugging a Program Exit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ble-index.html" class="btn btn-neutral" title="Debugging" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Texas Instruments.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.01.00.05',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>