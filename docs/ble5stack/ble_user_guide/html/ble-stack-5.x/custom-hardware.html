

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TI Provided Board Files &mdash; BLE5-Stack User&#39;s Guide 1.00.01.04 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="BLE5-Stack User&#39;s Guide 1.00.01.04 documentation" href="../index.html"/>
        <link rel="up" title="Developing a Bluetooth Low Energy Application" href="index.html"/>
        <link rel="next" title="Micro BLE Stack" href="../u-stack/index.html"/>
        <link rel="prev" title="Stack Configurations" href="stack-configuration.html"/> 
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug ble-stack-5.x custom-hardware";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script> 

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8">     


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../ble-stack-5.x-guide/index.html" class="icon icon-home"> BLE5-Stack User's Guide
          

          
          </a>

          
            
            
              <div class="version">
                1.00.01.04
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../cc2640/disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/get-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc2640/platform.html">The CC2640R2F SDK Platform</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developing a Bluetooth Low Energy Application</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="the-application.html">The Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-stack">The Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#creating-a-custom-bluetooth-low-energy-application">Creating a Custom Bluetooth low energy Application</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#running-the-sdk-on-custom-boards">Running the SDK on Custom Boards</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">TI Provided Board Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-type-and-board-files">Package Type and  Board Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-custom-board-file">Creating a Custom Board File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#board-level-middleware">Board Level Middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-32-khz-crystal-less-mode">Using 32-kHz Crystal-Less Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-rf-front-end-for-custom-hardware">Configuring the RF Front-End for Custom Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-device-parameters-for-custom-hardware">Configuring Device Parameters for Custom Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initial-board-bring-up">Initial Board Bring Up</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../u-stack/index.html">Micro BLE Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oad/oad.html">Over the Air Download (OAD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../voice/voice.html">Creating a Voice Enabled Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensor-controller/sensor-controller.html">Sensor Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging/ble-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/migration.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/api-reference.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-5.x-guide/reference.html">Terms and Definitions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../ble-stack-5.x-guide/index.html">BLE5-Stack User's Guide</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../ble-stack-5.x-guide/index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developing a Bluetooth Low Energy Application</a> &raquo;</li>
        
      <li>TI Provided Board Files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>This section will explain how to adapt a BLE application from the SimpleLink CC2640R2 SDK to run on
custom hardware. In general, the steps required to migrate a BLE application
from a development kit to a custom board are minimal and involve changing the
pin configuration as well as selecting the correct RF configuration.
These steps, including a bring up guide, are detailed in the subsections below.</p>
<div class="section" id="ti-provided-board-files">
<span id="board-file"></span><h1>TI Provided Board Files<a class="headerlink" href="#ti-provided-board-files" title="Permalink to this headline">Â¶</a></h1>
<p>In order to make the SimpleLink CC2640R2 SDK&#8216;s sample applications portable across different board
and package types, a high level gateway file is used to select the proper board
file based on the &lt;board_type&gt; predefined symbol. The top-level board file
(board.c) then uses this symbol to include the correct board file into the
project. This top-level board file can be found at
<em>&lt;SDK_INSTALL_DIR&gt;\source\ti\ble5stack\target\board.c</em>, and is located
under the Startup folder in the project workspace:</p>
<div class="figure align-center" id="startup">
<img alt="../_images/image178.jpeg" src="../_images/image178.jpeg" />
</div>
<p>The board file links in another gateway board file located at
<em>&lt;SDK_INSTALL_DIR&gt;\source\ti\ble5stack\target\&lt;kit_type&gt;</em>,
which finally links in the actual board file from
<em>&lt;SDK_INSTALL_DIR&gt;\source\ti\boards\&lt;board_type&gt;</em>.</p>
<p>&lt;kit_type&gt; indicates a handful of reference board files  supported by the
SimpleLink CC2640R2 SDK such as:</p>
<blockquote>
<div><ul class="simple">
<li>cc2640r2em</li>
<li>cc2640r2lp</li>
<li>cc2640r2rc</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The &lt;kit_type&gt; is an intermediate step within the board gateway and will not
need to be modified by the user while running on a TI EM or LP. Don&#8217;t try to
set &lt;kit_type&gt; as a predefined symbol  in your application.</p>
</div>
<p>The &lt;board_type&gt; define is set by the app project&#8217;s predefined symbols.
The following defines are supported by the SimpleLink CC2640R2 SDK and refer to a reference design
(EM or LaunchPad) created by TI.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.ti.com/lit/zip/swrc335">CC2640R2_LAUNCHXL</a>.</li>
<li><a class="reference external" href="http://www.ti.com/lit/zip/swrc300">CC2640R2DK_4XS</a>.</li>
<li><a class="reference external" href="http://www.ti.com/lit/zip/swrc299">CC2640R2DK_5XD</a>.</li>
<li><a class="reference external" href="http://www.ti.com/lit/zip/swrc298">CC2640R2DK_7ID</a>.</li>
<li><a class="reference external" href="http://www.ti.com/lit/zip/swrc336">CC2640R2DK_CXS</a>.</li>
<li><a class="reference external" href="http://www.ti.com/tool/CC2650RC#technicaldocuments">CC2640R2RC</a>.</li>
</ul>
</div></blockquote>
<p>By changing the define above, the application project will pull in a board file
that is adopted for the TI reference designs or development kits with same name.
Click the links above for more information on their respective TI reference
designs.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The CC2640R2F is pin compatible with the CC2650 and CC2640 wireless MCUs in
equivalent QFN package sizes, so the above reference designs can be used when
designing with the CC2640R2F.</p>
</div>
<p>Note that within the <code class="docutils literal"><span class="pre">&lt;board_name&gt;.h</span></code> file the symbol used to select the board&#8217;s
the RF front end configuration will be defined. See <code class="docutils literal"><span class="pre">ble_user_config.h</span></code> and
<a class="reference internal" href="#sec-creating-a-custom-ble-app-rf-front-end-and-antennas"><span class="std std-ref">Configuring the RF Front-End for Custom Hardware</span></a> for more
information on available RF front end configurations.</p>
</div>
<div class="section" id="package-type-and-board-files">
<span id="sect-packages-and-board-files"></span><h1>Package Type and  Board Files<a class="headerlink" href="#package-type-and-board-files" title="Permalink to this headline">Â¶</a></h1>
<p>Most of the examples within the SimpleLink CC2640R2 SDK will run on the <a class="reference external" href="http://www.ti.com.cn/tool/launchxl-cc2640r2">CC2640R2 Launchpad</a> out of the box. Board
files based on the TI CC26xx evaluation module (EM) reference designs are also
provided for your convenience. (See <a class="reference internal" href="#board-file"><span class="std std-ref">TI Provided Board Files</span></a> for more info)
However, for custom hardware designs it may be necessary to modify the provided
board files based on your selected package and RF configuration.</p>
<p>The board file for CC2640R2_LAUNCHXL is made for the 7x7 mm QFN package using
differential RF front end and internal biasing. To convert this board file to
use for other smaller device packages (5x5 mm and 4x4 mm QFN), the board file
will need to be modified since limited number of IO pins are available in the
smaller packages.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is recommended to start customizing board file(s) based on a reference
design that is most similar to your selected package type and RF configuration.
For example a design for a 5x5 mm QFN package with a differential front end
and external bias should use the <a class="reference external" href="http://www.ti.com/lit/zip/swrc299">CC2640R2DK_5XD</a>
board files as a reference.</p>
</div>
<p>Refer to the datasheet for all the package options and IO descriptions:
<a class="reference external" href="http://www.ti.com/lit/pdf/swcu117">CC2640R2 Datasheet</a></p>
<p>For example, to change to the 4x4 package, remove all defines for all IOs
not available (IOID_10 and higher) since the 4x4 package
has only 10 DIO pins as listed in the datasheet.</p>
<p>The table below shows the number of GPIOs supported by each package:</p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="24%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Package Option</th>
<th class="head">Total GPIO Pins</th>
<th class="head">MAX IOID</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7x7 mm QFN</td>
<td>31</td>
<td>IOID_30</td>
</tr>
<tr class="row-odd"><td>5x5 mm QFN</td>
<td>15</td>
<td>IOID_14</td>
</tr>
<tr class="row-even"><td>4x4 mm QFN</td>
<td>10</td>
<td>IOID_9</td>
</tr>
<tr class="row-odd"><td>2.7 x 2.7 mm WCSP</td>
<td>14</td>
<td>IOID_13</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="creating-a-custom-board-file">
<h1>Creating a Custom Board File<a class="headerlink" href="#creating-a-custom-board-file" title="Permalink to this headline">Â¶</a></h1>
<p>TI-RTOS drivers rely on &#8220;board files&#8221; for their board-specific configuration
parameters. The convention is to name these files based on the development kits
provided by TI in addition to a generic <code class="docutils literal"><span class="pre">Board.h</span></code> with <code class="docutils literal"><span class="pre">Board_*</span></code> definitions
to map the proper pins defined by <code class="docutils literal"><span class="pre">ioc.h</span></code>.</p>
<p>For example, for the simple_peripheral project, the following comprise the
set of board files used by the CC2640R2 LaunchPad development kit:</p>
<blockquote>
<div>Board.h
CC2640R2_LAUNCHXL.h
CC2640R2_LAUNCHXL.c</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">simple_peripheral board files are located in
<code class="docutils literal"><span class="pre">&lt;SDK_INSTALL_DIR&gt;\source\ti\boards\CC2640R2_LAUNCHXL</span></code></p>
</div>
<p>TI recommends to start with these existing set of board files when porting
a BLE application to custom development boards. When modifying or porting these
board files, user should consult with
<a class="reference external" href="../../../../tidrivers/tidriversAPIs.html">TI Driver APIs</a>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Board files provided by TI include TI-RTOS driver configuration data
structures for various drivers. If the application does not use the
associated TI-RTOS drivers, the linker will simply omit them from the
application image.</p>
</div>
<p>The following steps provide guidance on customizing board files for a
BLE5-Stack 1.00.01.04 project.</p>
<ol class="arabic">
<li><p class="first">Duplicate existing board files from existing CC2640R2_LAUNCHXL board files.</p>
<blockquote>
<div><ul class="simple">
<li>These files can be found at:
<code class="docutils literal"><span class="pre">&lt;SDK_INSTALL_DIR&gt;\source\ti\boards\CC2640R2_LAUNCHXL</span></code></li>
<li>Create a copy of the <code class="docutils literal"><span class="pre">CC2640R2_LAUNCHXL</span></code> directory and give it a unique
meaningful name for your development platform. In this example, we call
it <code class="docutils literal"><span class="pre">MYBOARD</span></code>.</li>
</ul>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">The SimpleLink CC2640R2 SDK also contains board files for TI-RTOS kernel and driver examples.
These are not compatible with the BLE5-Stack 1.00.01.04 because of differences in
RF driver SWI priorities and custom drivers (e.g. TRNG) required by
BLE5-Stack 1.00.01.04. For BLE5-Stack projects, use the files specified above for
reference from simple_peripheral.</p>
</div>
<ul class="simple">
<li>In the <code class="docutils literal"><span class="pre">MYBOARD</span></code> directory, rename <code class="docutils literal"><span class="pre">CC2640R2_LAUNCHXL.c</span></code> and
<code class="docutils literal"><span class="pre">CC2640R2_LAUNCHXL.h</span></code> to their <code class="docutils literal"><span class="pre">MYBOARD.c</span></code> and <code class="docutils literal"><span class="pre">MYBOARD.h</span></code>
respectively.</li>
<li>Search and replace all references of <code class="docutils literal"><span class="pre">CC2640R2_LAUNCHXL</span></code> with
<code class="docutils literal"><span class="pre">MYBOARD</span></code> in <code class="docutils literal"><span class="pre">Board.h</span></code>, <code class="docutils literal"><span class="pre">MYBOARD.c</span></code> and <code class="docutils literal"><span class="pre">MYBOARD.h</span></code>.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Add a new preprocessor define in your project&#8217;s <code class="docutils literal"><span class="pre">board.c</span></code> and <code class="docutils literal"><span class="pre">board.h</span></code>
files.</p>
<blockquote>
<div><p>Continuing with the <code class="docutils literal"><span class="pre">MYBOARD</span></code> example, modify <code class="docutils literal"><span class="pre">board.c</span></code> and <code class="docutils literal"><span class="pre">board.h</span></code>
in <code class="docutils literal"><span class="pre">&lt;SDK_INSTALL_DIR&gt;\source\ti\target</span></code></p>
<ul>
<li><p class="first">Replace <code class="docutils literal"><span class="pre">CC2640R2_LAUNCHXL</span></code> by <code class="docutils literal"><span class="pre">MYBOARD</span></code> in your project&#8217;s application
predefined symbols
(See <a class="reference internal" href="../cc2640/developing_in_ccs.html#sec-developing-with-ccs-accessing-preprocessor-symbols"><span class="std std-ref">Accessing Preprocessor Symbols</span></a>
or <a class="reference internal" href="../cc2640/developing_in_iar.html#sec-developing-with-iar-accessing-preprocessor-symbols"><span class="std std-ref">Accessing Preprocessor Symbols</span></a>)</p>
</li>
<li><p class="first">In <code class="docutils literal"><span class="pre">board.h</span></code>, add a link to your <code class="docutils literal"><span class="pre">Board.h</span></code> file.</p>
<blockquote>
<div><div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#elif defined(CC2640R2_LAUNCHXL)</span>
    <span class="cp">#include</span> <span class="cpf">&quot;./cc2640r2lp/cc2640r2lp_board.h&quot;</span><span class="cp"></span>
<span class="hll"><span class="cp">#elif defined(MYBOARD)</span>
</span><span class="hll">    <span class="cp">#include</span> <span class="cpf">&quot;../../boards/MYBOARD/Board.h&quot;</span><span class="cp"></span>
</span></pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
<li><p class="first">In <code class="docutils literal"><span class="pre">board.c</span></code>, add the highlighted lines shown below:</p>
<blockquote>
<div><div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#elif defined(CC2640R2_LAUNCHXL)</span>
    <span class="cp">#include</span> <span class="cpf">&quot;./cc2640r2lp/cc2640r2lp_board.c&quot;</span><span class="cp"></span>
<span class="hll"><span class="cp">#elif defined(MYBOARD)</span>
</span><span class="hll">    <span class="cp">#include</span> <span class="cpf">&quot;../../boards/MYBOARD/Board.h&quot;</span><span class="cp"></span>
</span><span class="hll">    <span class="cp">#include</span> <span class="cpf">&quot;../../boards/MYBOARD/MYBOARD.c&quot;</span><span class="cp"></span>
</span></pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
<li><p class="first">Explicit references to <code class="docutils literal"><span class="pre">CC2640R2_LAUNCHXL.h</span></code> need to be replaced by
<code class="docutils literal"><span class="pre">MYBOARD.h</span></code></p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Modify board files to match application requirements</p>
<blockquote>
<div><ul class="simple">
<li>PIN structure to match the layout of the board.
See <a class="reference internal" href="#sect-packages-and-board-files"><span class="std std-ref">Package Type and  Board Files</span></a>.</li>
<li>Add peripheral driver initialization objects according to the board design.
See <a class="reference internal" href="../cc2640/rtos-overview.html#peripherals-and-drivers"><span class="std std-ref">Drivers</span></a> for more information on drivers.</li>
<li>For RF driver configuration,
see <a class="reference internal" href="#sec-creating-a-custom-ble-app-rf-front-end-and-antennas"><span class="std std-ref">Configuring the RF Front-End for Custom Hardware</span></a></li>
</ul>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="board-level-middleware">
<h1>Board Level Middleware<a class="headerlink" href="#board-level-middleware" title="Permalink to this headline">Â¶</a></h1>
<p>There are also several board driver files which are a layer of
abstraction on top of TI-RTOS drivers, to function for a specific
board, for example Board_key.c, or ExtFlash.c If desired, these files can be
adapted to work for a custom board.</p>
</div>
<div class="section" id="using-32-khz-crystal-less-mode">
<h1>Using 32-kHz Crystal-Less Mode<a class="headerlink" href="#using-32-khz-crystal-less-mode" title="Permalink to this headline">Â¶</a></h1>
<p>BLE5-Stack 1.00.01.04 includes support for operating the CC2640R2F in a 32-kHz
crystal-less mode for peripheral and broadcaster (beacon) role configurations.
By using the internal low-frequency RC oscillator (RCOSC_LF), the 32-kHz crystal
can be removed from the board layout.</p>
<p>There are a few steps that must be taken to enable this feature.
For any peripheral project, the following change is required for IAR.
For CCS user, please see the
<a class="reference external" href="http://www.ti.com/lit/pdf/swra499">Running Bluetooth Low Energy on CC2640 Without 32 kHz Crystal</a>
for the needed steps to enable RCOSC_LF in your project.
You will find more detail regarding this feature in the aforementioned application note.</p>
<ol class="arabic">
<li><p class="first">Include <cite>rcosc_calibration.c</cite>, <cite>rcosc_calibration.h</cite> and <cite>ccfg_app_ble_rcosc.c</cite> files which locate at
<em>&lt;SDK_INSTALL_DIR&gt;\source\ti\ble5stack\common\cc26xx\rcosc</em></p>
</li>
<li><p class="first">Exclude ccfg_app_ble.c from build.</p>
</li>
<li><p class="first">Add USE_RCOSC to Defined symbols.</p>
</li>
<li><p class="first">Add the following code to your peripheral project.c</p>
<div class="literal-block-wrapper docutils container" id="include-rcosc-calibration">
<div class="code-block-caption"><span class="caption-number">Listing 86. </span><span class="caption-text">RCOSC calibration include</span><a class="headerlink" href="#include-rcosc-calibration" title="Permalink to this code">Â¶</a></div>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#ifdef USE_RCOSC</span>
<span class="cp">#include</span> <span class="cpf">&quot;rcosc_calibration.h&quot;</span><span class="cp"></span>
<span class="cp">#endif </span><span class="c1">//USE_RCOSC</span>
</pre></div>
</div>
</div>
</li>
<li><p class="first">Add the following code to your peripheralproject_init function in peripheral project.c</p>
<div class="literal-block-wrapper docutils container" id="enable-rcosc-calibration">
<div class="code-block-caption"><span class="caption-number">Listing 87. </span><span class="caption-text">RCOSC calibration enable</span><a class="headerlink" href="#enable-rcosc-calibration" title="Permalink to this code">Â¶</a></div>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#ifdef USE_RCOSC</span>
<span class="n">RCOSC_enableCalibration</span><span class="p">();</span>
<span class="cp">#endif </span><span class="c1">// USE_RCOSC</span>
</pre></div>
</div>
</div>
</li>
<li><p class="first">If using a custom board file, enable the RCOSC in the power policy.
The board files included with the BLE5-Stack:</p>
<div class="literal-block-wrapper docutils container" id="power-driver-code-snippet">
<div class="code-block-caption"><span class="caption-number">Listing 88. </span><span class="caption-text">Power driver configuration</span><a class="headerlink" href="#power-driver-code-snippet" title="Permalink to this code">Â¶</a></div>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">PowerCC26XX_Config</span> <span class="n">PowerCC26XX_config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">.</span><span class="n">policyInitFxn</span>     <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
  <span class="p">.</span><span class="n">policyFxn</span>         <span class="o">=</span> <span class="o">&amp;</span><span class="n">PowerCC26XX_standbyPolicy</span><span class="p">,</span>
  <span class="p">.</span><span class="n">calibrateFxn</span>      <span class="o">=</span> <span class="o">&amp;</span><span class="n">PowerCC26XX_calibrate</span><span class="p">,</span>
  <span class="p">.</span><span class="n">enablePolicy</span>      <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span>
<span class="hll">  <span class="p">.</span><span class="n">calibrateRCOSC_LF</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span>
</span>  <span class="p">.</span><span class="n">calibrateRCOSC_HF</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</li>
<li><p class="first">Constrain the temperature variation to be less than 1Â°C/sec. If the
temperature is to change faster than 1Â°C/sec, then a short
calibration interval must be used.
Calibration interval can be tuned in rcosc_calibration.h</p>
<div class="literal-block-wrapper docutils container" id="rcosclf-calibration-interval-setup">
<div class="code-block-caption"><span class="caption-number">Listing 89. </span><span class="caption-text">RCOSCLF calibration interval</span><a class="headerlink" href="#rcosclf-calibration-interval-setup" title="Permalink to this code">Â¶</a></div>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="c1">// 1000 ms</span>
<span class="cp">#define RCOSC_CALIBRATION_PERIOD   1000</span>
</pre></div>
</div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use of the internal RCOSC_LF requires a sleep clock accuracy (SCA) of 500 ppm.</p>
</div>
</div>
<div class="section" id="configuring-the-rf-front-end-for-custom-hardware">
<span id="sec-creating-a-custom-ble-app-rf-front-end-and-antennas"></span><h1>Configuring the RF Front-End for Custom Hardware<a class="headerlink" href="#configuring-the-rf-front-end-for-custom-hardware" title="Permalink to this headline">Â¶</a></h1>
<p>The CC2640R2F supports multiple RF front end options to optimize performance or
cost. Reference designs are available for multiple RF front end options to aid
in decoupling and RF layout. In order to achieve optimal sensitivity, it is
important to configure the BLE application with the correct RF front end setting
used on the custom board. An incorrectly configured RF front end may result in
substantially degraded RF performance such as the inability to maintain a
connection with a peer device. Configuration of the Front-EndRF front end is
done within the board file.</p>
<p>For example, within the simple_peripheral project, the RF front end
configuration is defined in <code class="docutils literal"><span class="pre">CC2640R2_LAUNCHXL.h</span></code> with:</p>
<blockquote>
<div><div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define CC2650EM_7ID</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>The defined symbol is used in <code class="docutils literal"><span class="pre">ble_user_config.h</span></code> and <code class="docutils literal"><span class="pre">ble_user_config.c</span></code>
to set the correct RF Front end mode, and the select the appropriate PA table
for that configuration. In ble_user_config.h, <code class="docutils literal"><span class="pre">CC2650EM_7ID</span></code> is processed to
define <code class="docutils literal"><span class="pre">RF_FE_MODE_AND_BIAS</span></code>:</p>
<blockquote>
<div><div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define CC2650EM_7ID</span>

<span class="c1">// RF Front End Mode and Bias configuration</span>

<span class="cp">#if defined( CC26XX )</span>

<span class="cp">#if defined( CC2650EM_7ID )</span>

<span class="cp">#define RF_FE_MODE_AND_BIAS           ( RF_FE_DIFFERENTIAL |\</span>
<span class="cp">                                        RF_FE_INT_BIAS)</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>This configures the project to use a differential RF with internal bias.
Other configurations can also be found in <code class="docutils literal"><span class="pre">ble_user_config.h</span></code>, select the
configuration appropriate to your project.</p>
<p>In <code class="docutils literal"><span class="pre">ble_user_config.c</span></code>, <code class="docutils literal"><span class="pre">CC2650EM_7ID</span></code> selects the appropriate PA table,
in this case for differential RF. For CC2640R2F, there are three PA tables,
one for differential operation on QFN packages, one for single ended on QFN,
and one for single ended on WCSP.</p>
<blockquote>
<div><div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#elif defined( CC26XX )</span>

  <span class="cp">#if defined( CC2650EM_7ID ) || defined( CC2650EM_5XD ) || defined( CC2650M5A )</span>

  <span class="c1">// Differential Output</span>

  <span class="c1">// Tx Power Values (Pout, IB, GC, TC)</span>
  <span class="k">const</span> <span class="n">txPwrVal_t</span> <span class="n">TxPowerTable</span><span class="p">[]</span> <span class="o">=</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There are several other parameters being configured in <code class="docutils literal"><span class="pre">ble_user_config</span></code>.
For CC2640R2F it is only the RF front end mode and PA table that have to be
changed for different boards.</p>
</div>
<p>For information on front ends and antenna configurations, see
<a class="reference external" href="http://processors.wiki.ti.com/images/4/45/CC26xx_HW_training_RF_Frontends_and_Antennas.pdf">CC26xx RF FrontEnds and Antennas</a>.</p>
<p>For information on other hardware considerations, see <a class="reference external" href="http://ti.com/ble-wiki">TI Bluetooth Low Energy Wiki</a>.</p>
</div>
<div class="section" id="configuring-device-parameters-for-custom-hardware">
<h1>Configuring Device Parameters for Custom Hardware<a class="headerlink" href="#configuring-device-parameters-for-custom-hardware" title="Permalink to this headline">Â¶</a></h1>
<blockquote>
<div><ol class="arabic simple">
<li>Set parameters, such as the sleep clock accuracy of the 32.768-kHz
crystal. See <a class="reference external" href="../doxygen/group___h_c_i.html#ga650463588bfd77c7c745cb93dff3ce2d">HCI_EXT_SetSCACmd()</a></li>
<li>Define the CCFG parameters in ccfg_app_ble.c to enable or
disable the ROM serial bootloader, JTAG access (DAP), flash
protection, and so forth.</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For a description of CCFG configuration parameters, see
the <a class="reference external" href="http://www.ti.com/lit/pdf/swcu117">CC26xx Technical Reference Manual</a>.</p>
</div>
</div>
<div class="section" id="initial-board-bring-up">
<h1>Initial Board Bring Up<a class="headerlink" href="#initial-board-bring-up" title="Permalink to this headline">Â¶</a></h1>
<p>When powering up a custom board with the CC2640R2F for the first time, it is
recommended to complete the HW checklist items on the TI BLE Wiki.
After confirming that the board is being powered correctly by the battery or
power supply and can be identified by the JTAG tool, programming the device with
a minimal SW application to verify stability is also suggested.</p>
<p>TI recommends using the simple_peripheral sample application for initial board
bring  up with modifications to the board file to:</p>
<ol class="arabic simple">
<li>Disable all GPIO pin access</li>
<li>Select the correct RF front end setting.</li>
</ol>
<p>To disable all GPIO pin configuration, set the <code class="docutils literal"><span class="pre">BoardGpioInitTable</span></code> in the
board file to <code class="docutils literal"><span class="pre">PIN_TERMINATE</span></code>:</p>
<blockquote>
<div><div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">PIN_Config</span> <span class="n">BoardGpioInitTable</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="n">PIN_TERMINATE</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>The TI BLE5-Stack does not require any GPIO pins to be configured in order to
establish and maintain a BLE connection. Ensure that <code class="docutils literal"><span class="pre">Display_DISABLE_ALL</span></code>
is defined in the application Predefined Symbols so that diagnostic logging
data is not routed to any GPIO pin. If your custom board uses a different device
configuration, such as the 32 kHz crystal-less RCOSC_LF configuration, be sure
to make these device changes to the project. With this minimal application
configuration you should be able to establish a BLE connection
(e.g., with a smart phone or BTool) to your board at the expected range.
If you are not able to complete this step, then it is likely there is a
misconfiguration of the RF front end or you have other board related or layout
issues. Refer to the hardware troubleshooting tips on the TI BLE Wiki.</p>
<p>After confirming that your board can maintain a BLE connection, you can now
validate that your BLE application functions as expected on the custom board.
Again, it is suggested to enable your GPIO pins one at a time in the board file
and comment-out access to other GPIO pins in your application. If you do
encounter a CPU exception (HWI abort) during this phase it is likely that a
GPIO pin is incorrectly mapped in your custom board file or your application is
attempting to access a GPIO pin that does not exist in your device package type.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../u-stack/index.html" class="btn btn-neutral float-right" title="Micro BLE Stack" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="stack-configuration.html" class="btn btn-neutral" title="Stack Configurations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Texas Instruments.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.00.01.04',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>